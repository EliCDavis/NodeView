"use strict";function Graph2D(e){var t=this,n=1,o=0,i=0,r=[],a={centerOnNodes:{value:!0,constructor:Boolean},applyGravity:{value:!0,constructor:Boolean},applyTranslation:{value:!0,constructor:Boolean}};t.setOption=function(e,t){if("string"!=typeof e)throw e;try{if(a[e].constructor!==t.constructor)throw a[e].constructor,t.constructor;a[e].value=t}catch(n){throw n}};var s=[],u=null,d=function(e,t,n,o){var i=e.getContext();i.strokeStyle="#ffffff",i.lineWidth=5*e.getScale(),i.beginPath(),i.moveTo(t[0],t[1]),i.lineTo(n[0],n[1]),i.stroke()};t.nodesAreLinked=function(e,t){return e.isLinkedWith(t)},t.setLinkRenderMethod=function(e){return"function"!=typeof e?void console.error("Failure to set Link Render Method!                            Arguement must be typeof function!"):4!==e.length?void console.error("Failure to set Link Render Method!                            Method's arguement length must be 4 so it                           can be passed the graph being rendered, node 1                           position on canvas, node 2 position on canvas, and                           any link data associated with them!"):void(d=e)},t.setBackgroundRenderMethod=function(e){return"function"!=typeof e?void console.error("Failure to set Background Render Method!                            Arguement must be typeof function!"):1!==e.length?void console.error("Failure to set Background Render Method!                            Method's arguement length must be 1 so it                           can be passed the graph being rendered!"):void(u=e)};var c=function(e){var r=t.getContext().canvas.relMouseCoords(e),a=r.x/n-o,s=r.y/n-i;return{x:a,y:s}},l=null;t.getContext=function(){return l};var f=function(){return[t.getContext().canvas.width,t.getContext().canvas.height]},g="free",h=null,v=null,p=function(e){e.setRenderDataByKey("$beingDragged",!0),e.setVelocity(0,0);for(var t=e.getLinks(),n=0;n<t.length;n++)t[n].node.setRenderDataByKey("$neighborBeingDragged",!0)},m=function(e){e.setRenderDataByKey("$beingDragged",!1);for(var t=e.getLinks(),n=0;n<t.length;n++)t[n].node.setRenderDataByKey("$neighborBeingDragged",!1)},y=function(e){if(!e.getRenderData().$mouseOver){e.setRenderDataByKey("$mouseOver",!0);for(var t=e.getLinks(),n=0;n<t.length;n++)t[n].node.setRenderDataByKey("$neighborMouseOver",!0)}},x=function(e){e.setRenderDataByKey("$mouseOver",!1);for(var t=e.getLinks(),n=0;n<t.length;n++)t[n].node.setRenderDataByKey("$neighborMouseOver",!1)},k=function(e){if(v=e,"dragging"===g)return"node"===h.itemType&&m(h.item),h=null,void(g="free");var n=c(e);r.forEach(function(e){e.wasClicked(t,[n.x,n.y])&&null!==e.onclick&&void 0!==e.onclick&&e.onclick()}),g="free"},M=function(e,n){return null===e.getClickDetectionFunction()?T(e,t,[n.x,n.y]):e.wasClicked(t,[n.x,n.y])},P=function(e){v=e;var n=c(e);g="hold",r.forEach(function(e){var t=M(e,n);t&&(h={item:e,itemPos:e.getPosition(),mousePos:[n.x,n.y],itemType:"node"})}),null===h&&(h={item:t,itemPos:t.getPosition(),mousePos:[n.x,n.y],itemType:"graph"})},w=function(e){null!==h&&"node"===h.itemType&&(m(h.item),x(h.item)),v=null,h=null,"dragging"===g&&(g="free")},R=function(e){if(v=e,"hold"===g&&(g="dragging","node"===h.itemType&&p(h.item)),"dragging"===g){var o=h.itemPos,i=h.mousePos;if("node"===h.itemType){var r=c(e);h.item.setPosition(r.x+(o[0]-i[0]),r.y+(o[1]-i[1]))}if("graph"===h.itemType){var r=t.getContext().canvas.relMouseCoords(e),a=r.x/n,s=r.y/n;h.item.setPosition(a-i[0],s-i[1])}}},D=function(e){var o=n,i=0;i=e.deltaY>0?-.05:.05,o+=i*o;var r=f(),a=[r[0]*(1/n)*.5,r[1]*(1/n)*.5],s=[r[0]*(1/o)*.5,r[1]*(1/o)*.5],u=t.getPosition();t.setPosition(u[0]+(s[0]-a[0]),u[1]+(s[1]-a[1])),n=o},b=function(e){},C=function(e){e.addEventListener("mouseup",function(e){k(e)}),e.addEventListener("mousedown",function(e){P(e)}),e.addEventListener("mouseout",function(e){w(e)}),e.addEventListener("mousemove",function(e){R(e)}),e.addEventListener("mousewheel",function(e){D(e)}),e.addEventListener("dblclick",function(e){b(e)})};null!==e&&void 0!==e&&(l=e.getContext("2d"),C(e)),t.kruskalsPath=function(e,t){throw"not yet implemented!"},t.getNodes=function(){return r},t.clearLinks=function(){r.forEach(function(e){e.clearLinks()}),s=[]},t.getNodeClosestToPoint=function(e){var t=null,n=1e7;return r.forEach(function(o){var i=o.distanceFrom(e);n>i&&(t=o,n=i)}),t},t.getPosition=function(){return[o,i]},t.setPosition=function(e,t){if(!isNumeric(e))throw"Failed to set graph position!  Invalid x value: "+e;if(!isNumeric(t))throw"Failed to set graph position!  Invalid y value: "+t;o=e,i=t},t.getScale=function(){return n};var F=function(e,t){for(var n=0;n<r.length;n++){var o=r[n].getPosition(),i=Math.sqrt(Math.pow(o[0]-e[0],2)+Math.pow(o[1]-e[1],2));if(t>i)return!1}return!0},L=function(e){var t=[0,0],n=[0,0];return e.forEach(function(e){n[0]+=e.getPosition()[0],n[1]+=e.getPosition()[1]}),t[0]=n[0]/e.length,t[1]=n[1]/e.length,t},N=function(e){if(0===r.length){var t=f(),o=[t[0]/2,t[1]/2];return[o[0]*(1/n),o[1]*(1/n)]}for(var i=L(r),a=e/4,s=0;1e4>s;){var u=2*s;0===s&&(u=1);for(var d=[],c=[],l=[],g=[],h=(s+.5)*a,v=[i[0]-h,i[1]-h],p=[i[0]+h,i[1]-h],m=[i[0]-h,i[1]+h],y=[i[0]+h,i[1]+h],x=0;u>x;x++)d.push([v[0],v[1]+a*x]),c.push([y[0],y[1]-a*x]),l.push([p[0]-a*x,p[1]]),g.push([m[0]+a*x,m[1]]);for(var k=d.concat(c).concat(l).concat(g),x=0;x<k.length;x++)if(F(k[x],e))return k[x];s++}return console.log("Failure to find place! Sorry dude."),[0,0]},E=function(e,t,n){var o=n.getScale(),i=e.getRenderData().size,r=[t[0]-i[0]/2*o,t[1]-i[1]/2*o];n.getContext().fillStyle=e.getRenderData().color,n.getContext().fillRect(r[0],r[1],i[0]*o,i[1]*o)},T=function(e,t,n){var o=e.getRenderData().size,i=[e.getPosition()[0]-o[0]/2,e.getPosition()[1]-o[1]/2],r=[o[0],o[1]];return pointsInsideRect([i[0],i[1],r[0],r[1]],n)};t.setDefaultNodeRenderAndMouseDetection=function(e,t){return"function"!=typeof e?void console.error("Failure to set Node Render Method!                            Arguement must be a function!"):3!==e.length?void console.error("Failure to set Node Render Method!                            Method's arguement length must be 3 so it                           can be passed the node, it's position, and graph being rendered!"):"function"!=typeof t?void console.error("Failure to set Node Click Detection Method!                            Arguement must be a function!"):3!==t.length?void console.error("Failure to set Node Render Method!                            Method's arguement length must be 2 so it                           can be passed the node and graph being rendered!"):(E=e,void(T=t))},t.createNode=function(e){var t=new Node2D;e&&e.renderData?Object.keys(e.renderData).forEach(function(n,o){t.setRenderDataByKey(n,e.renderData[n])}):(t.setRenderDataByKey("size",[40,40]),t.setRenderDataByKey("color","#000000"));var n=70;return e&&e.radius&&(n=e.radius),t.setRadius(n),e&&e.position?t.setPosition(e.position):e&&e.freeSpace?t.setPosition(N(e.freeSpace)):t.setPosition(N(3*n)),r.push(t),t},t.linkNodes=function(e,t,n){if(null===e||void 0===e)throw"Failure to link! The first node passed in to link was: "+e;if(null===t||void 0===t)throw"Failure to link! The second node passed in to link was: "+t;if(e.isLinkedWith(t))throw"Nodes are already linked!";e.addLink(t,n),t.addLink(e,n),s.push({nodes:[e,t],linkData:n})},t.setNodeAttractionMethod=function(e){return"function"!=typeof e?void console.error("Failure to set Node Attraction Method!                            Arguement must be typeof function!"):3!==e.length?void console.error("Failure to set Node Attraction Method!                            Method's arguement length must be 3 so it                           can be passed the two nodes being rendered and any                           data associated with them!!"):void(B=e)};var B=function(e,t,n){var o=n;void 0!==o&&null!==o||(o={});var i=e.pos,r=t.pos,a=e.mass,s=t.mass,u=r[0]-i[0],d=r[1]-i[1],c=Math.sqrt(u*u+d*d),l=Math.abs(a*s),f=l/(c*c)*1.1;return a+s>c&&(f*=-3.5),o.$groupPos&&(f=.05),f},O=function(e,t,n){var o=e.pos,i=t.pos,r=i[0]-o[0],a=i[1]-o[1],s=Math.sqrt(r*r+a*a);if(0===s)return[0,0];var u=B(e,t,n),d=Math.atan(a/r),c=1;return 0>r&&(c=-1),[Math.cos(d)*u*c,Math.sin(d)*u*c]},A=[];t.postRender=function(e){if("function"!=typeof e)throw"Post render only accepts functions!";A.push(e)};var $=function(){if(r&&0!==r.length){var e=L(r),t=f(),a=[t[0]/n/2-e[0],t[1]/n/2-e[1]],s=[a[0]-o,a[1]-i];o+=.1*s[0],i+=.1*s[1]}},I=function(e){e.forEach(function(t){var n=[0,0];e.forEach(function(e){var o={};t.isLinkedWith(e)&&(o.$linkData=t.getLinkData(e));var i=O({pos:t.getPosition(),mass:t.getRadius(),node:t},{pos:e.getPosition(),mass:e.getRadius(),node:e},o);n[0]+=i[0],n[1]+=i[1]});var o=O({pos:t.getPosition(),mass:t.getRadius(),node:t},{pos:[0,0],mass:2*t.getRadius(),group:!0},{$groupPos:!0});n[0]+=5*o[0],n[1]+=5*o[1],t.accelerate(n[0],n[1])})},K=function(e){M(e,c(v))?e.getRenderData().$mouseOver||y(e):e.getRenderData().$mouseOver&&x(e)},S=function(){l.canvas.width=l.canvas.offsetWidth,l.canvas.height=l.canvas.offsetHeight,l.clearRect(0,0,l.canvas.width,l.canvas.height),null!==u&&void 0!==u&&u(t),r.forEach(function(e){e.getChildren().forEach(function(r){var a=t.getContext();a.beginPath(),a.moveTo((e.getPosition()[0]+o)*n,(e.getPosition()[1]+i)*n),a.lineTo((r.getPosition()[0]+o)*n,(r.getPosition()[1]+i)*n),a.stroke()})}),s.forEach(function(e){var r=[(e.nodes[0].getPosition()[0]+o)*n,(e.nodes[0].getPosition()[1]+i)*n],a=[(e.nodes[1].getPosition()[0]+o)*n,(e.nodes[1].getPosition()[1]+i)*n];if(null!==d&&void 0!==d)return void d(t,r,a,e);var s=t.getContext();s.beginPath(),s.moveTo(r[0],r[1]),s.lineTo(a[0],a[1]),s.stroke()}),a.applyGravity.value&&I(r),r.forEach(function(e){var n=!1;a.applyTranslation.value&&(n=e.translate((Date.now()-q)/1e3)),null!==v&&(a.applyGravity.value&&a.applyTranslation.value?n&&K(e):K(e));var o=t.getPosition(),i=t.getScale(),r=[(e.getPosition()[0]+o[0])*i,(e.getPosition()[1]+o[1])*i];null!==e.getRenderFunction()&&void 0!==e.getRenderFunction()?e.render(e,r,t):E(e,r,t)}),A.forEach(function(e){e()}),A=[],!a.centerOnNodes.value||h&&"graph"===h.itemType||$(),q=Date.now(),window.requestAnimationFrame(S)},q=Date.now();S()}function Node2D(){function e(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)});return t}var t=this,n="Node Name",o="Data",i={$mouseOver:!1,$beingDragged:!1},r=0,a=0,s=[],u=null,d=[],c=null,l=1,f=[0,0],g=e();t.getId=function(){return g},t.getGroupId=function(){return c},t.setVelocity=function(e,t){console.log("Velocity set"),f=[e,t]},t.accelerate=function(e,t){var n=3e4;f[0]=Math.max(Math.min(n,f[0]+e),-n),f[1]=Math.max(Math.min(n,f[1]+t),-n)};var h=function(e){var t=f[0]>0?-1:1,n=f[1]>0?-1:1;f[0]+=Math.sqrt(Math.abs(f[0]))*e*t*2,f[1]+=Math.sqrt(Math.abs(f[1]))*e*n*2};t.translate=function(e){return 0===f[0]&&0===f[1]?!1:(r+=f[0]*e,a+=f[1]*e,h(e),!0)},t.distanceFrom=function(e,t){return e.constructor===Array&&(t=e[1],e=e[0]),Math.sqrt(Math.pow(e-r,2)+Math.pow(t-a,2))},t.setRadius=function(e){l=e},t.getRadius=function(){return l},t.onclick=function(){console.log("Clicked")};var v=null,p=null;t.setRenderDataByKey=function(e,t){i[e]=t},t.getRenderData=function(){return i},t.wasClicked=function(e,n){if(null!==p&&void 0!==p){var o=p(t,e,n);if(o===!0||o===!1)return o}return!1},t.setRenderFunction=function(e,t){if(null===e)throw"Error setting render funciton for Node! Attempting to add a null render method";if(null===t)throw"Error setting render funciton for Node! Attempting to add a null click detection method";v=e,p=t},t.getRenderFunction=function(){return v},t.getClickDetectionFunction=function(){return p},t.render=function(e,t,n){if(null===v)throw"Failure to render node! There's no render function defined!";v(e,t,n)},t.getPosition=function(){return[r,a]},t.setPosition=function(e,t){return e.constructor===Array?(r=e[0],void(a=e[1])):(r=e,void(a=t))},t.getContents=function(){return n+" - "+o},t.addLink=function(e,t){if(null===e||void 0===e)throw"Failure to link node!  Link node was: "+e;d.push({node:e,linkData:t})},t.getLinks=function(){return d},t.isLinkedWith=function(e){for(var t=0;t<d.length;t++)if(d[t].node.getId()===e.getId())return!0;return!1},t.getLinkData=function(e){for(var t=0;t<d.length;t++)if(d[t].node.getId()===e.getId())return d[t].node;return null},t.clearLinks=function(){d=[]},t.setParent=function(e){null!==u&&void 0!==u&&u.removeChild(t),u=e,-1===u.getChildren().indexOf(t)&&u.addChild(t)},t.getParent=function(){return u},t.addChild=function(e){return-1!==s.indexOf(e)?void console.log("We already have that node as a child; ",e):(s.push(e),void(e.getParent()!==t&&e.setParent(t)))},t.getChildren=function(){return s},t.removeChild=function(e){var t=s.indexOf(e);if(-1===t)throw"Failure to remove child! Trying to remove a child we don't have!";s.splice(t,1)}}function pointsInsideRect(e,t){if(null===e||void 0===e||null===e.length||void 0===e.length||4!==e.length)throw"Invalid rect argument! Expecting array in format [x, y, width, height].  Instead recieved: "+e;if(null===t||void 0===t||null===t.length||void 0===t.length||2!==t.length)throw"Invalid point argument! Expecting array in format [x, y].  Instead recieved: "+t;return e[0]<=t[0]&&t[0]<=e[0]+e[2]&&e[1]<=t[1]&&t[1]<=e[1]+e[3]}function isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}!function(){function e(e){var t=this.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),i=o.length>>>0;if(0===i)return-1;if(n=+t||0,1/0===Math.abs(n)&&(n=0),n>=i)return-1;for(n=Math.max(n>=0?n:i-Math.abs(n),0);i>n;){if(n in o&&o[n]===e)return n;n++}return-1}),HTMLCanvasElement.prototype.relMouseCoords=e}();