"use strict";function Graph2D(e){var t=this,n=1,o=0,i=0,r=[],a=[],u=null,s=null;t.setLinkRenderMethod=function(e){return"function"!=typeof e?void console.error("Failure to set Link Render Method!                            Arguement must be typeof function!"):4!==e.length?void console.error("Failure to set Link Render Method!                            Method's arguement length must be 4 so it                           can be passed the graph being rendered, node 1                           position on canvas, node 2 position on canvas, and                           any link data associated with them!"):void(s=e)},t.setBackgroundRenderMethod=function(e){return"function"!=typeof e?void console.error("Failure to set Background Render Method!                            Arguement must be typeof function!"):1!==e.length?void console.error("Failure to set Background Render Method!                            Method's arguement length must be 1 so it                           can be passed the graph being rendered!"):void(u=e)};var d=function(e){var r=t.getContext().canvas.relMouseCoords(e),a=r.x/n-o,u=r.y/n-i;return{x:a,y:u}},c=null;t.getContext=function(){return c};var l=function(){return[t.getContext().canvas.width,t.getContext().canvas.height]},f="free",g=null,h=null,v=function(e){if(h=e,"dragging"===f)return"node"===g.itemType&&g.item.setRenderDataByKey("$beingDragged",!1),g=null,void(f="free");var n=d(e);r.forEach(function(e){e.wasClicked(t,[n.x,n.y])&&null!==e.onclick&&void 0!==e.onclick&&e.onclick()}),f="free"},m=function(e,n){return null===e.getClickDetectionFunction()?F(e,t,[n.x,n.y]):e.wasClicked(t,[n.x,n.y])},p=function(e){h=e;var n=d(e);f="hold",r.forEach(function(e){var t=m(e,n);t&&(g={item:e,itemPos:e.getPosition(),mousePos:[n.x,n.y],itemType:"node"})}),null===g&&(g={item:t,itemPos:t.getPosition(),mousePos:[n.x,n.y],itemType:"graph"})},y=function(e){h=null,"dragging"===f&&(f="free")},P=function(e){if(h=e,"hold"===f&&(f="dragging","node"===g.itemType&&g.item.setRenderDataByKey("$beingDragged",!0)),"dragging"===f){var o=g.itemPos,i=g.mousePos;if("node"===g.itemType){var r=d(e);g.item.setPosition(r.x+(o[0]-i[0]),r.y+(o[1]-i[1]))}if("graph"===g.itemType){var r=t.getContext().canvas.relMouseCoords(e),a=r.x/n,u=r.y/n;g.item.setPosition(a-i[0],u-i[1])}}},M=function(e){var o=n,i=0;i=e.deltaY>0?-.05:.05,o+=i*o;var r=l(),a=[r[0]*(1/n)*.5,r[1]*(1/n)*.5],u=[r[0]*(1/o)*.5,r[1]*(1/o)*.5],s=t.getPosition();t.setPosition(s[0]+(u[0]-a[0]),s[1]+(u[1]-a[1])),n=o},w=function(e){},R=function(e){e.addEventListener("mouseup",function(e){v(e)}),e.addEventListener("mousedown",function(e){p(e)}),e.addEventListener("mouseout",function(e){y(e)}),e.addEventListener("mousemove",function(e){P(e)}),e.addEventListener("mousewheel",function(e){M(e)}),e.addEventListener("dblclick",function(e){w(e)})};null!==e&&void 0!==e&&(c=e.getContext("2d"),R(e)),t.getPosition=function(){return[o,i]},t.setPosition=function(e,t){if(!isNumeric(e))throw"Failed to set graph position!  Invalid x value: "+e;if(!isNumeric(t))throw"Failed to set graph position!  Invalid y value: "+t;o=e,i=t},t.getScale=function(){return n};var x=function(e,t){for(var n=0;n<r.length;n++){var o=r[n].getPosition(),i=Math.sqrt(Math.pow(o[0]-e[0],2)+Math.pow(o[1]-e[1],2));if(t>i)return!1}return!0},k=function(e){if(0===r.length){var t=l(),o=[t[0]/2,t[1]/2];return[o[0]*(1/n),o[1]*(1/n)]}var i=[0,0],a=[0,0];r.forEach(function(e){a[0]+=e.getPosition()[0],a[1]+=e.getPosition()[1]}),i[0]=a[0]/r.length,i[1]=a[1]/r.length;for(var u=e/4,s=(Math.sqrt(u*u*2),0);1e4>s;){var d=2*s;0===s&&(d=1);for(var c=[],f=[],g=[],h=[],v=(s+.5)*u,m=[i[0]-v,i[1]-v],p=[i[0]+v,i[1]-v],y=[i[0]-v,i[1]+v],P=[i[0]+v,i[1]+v],M=0;d>M;M++)c.push([m[0],m[1]+u*M]),f.push([P[0],P[1]-u*M]),g.push([p[0]-u*M,p[1]]),h.push([y[0]+u*M,y[1]]);for(var w=c.concat(f).concat(g).concat(h),M=0;M<w.length;M++)if(x(w[M],e))return w[M];s++}return console.log("Failure to find place! Sorry dude."),[0,0]},C=function(e,t,n){var o=n.getScale(),i=e.getRenderData().size,r=[t[0]-i[0]/2*o,t[1]-i[1]/2*o];n.getContext().fillStyle=e.getRenderData().color,n.getContext().fillRect(r[0],r[1],i[0]*o,i[1]*o)},F=function(e,t,n){var o=e.getRenderData().size,i=[e.getPosition()[0]-o[0]/2,e.getPosition()[1]-o[1]/2],r=[o[0],o[1]];return pointsInsideRect([i[0],i[1],r[0],r[1]],n)};t.setDefaultNodeRenderAndMouseDetection=function(e,t){return"function"!=typeof e?void console.error("Failure to set Node Render Method!                            Arguement must be a function!"):3!==e.length?void console.error("Failure to set Node Render Method!                            Method's arguement length must be 3 so it                           can be passed the node, it's position, and graph being rendered!"):"function"!=typeof t?void console.error("Failure to set Node Click Detection Method!                            Arguement must be a function!"):3!==t.length?void console.error("Failure to set Node Render Method!                            Method's arguement length must be 2 so it                           can be passed the node and graph being rendered!"):(C=e,void(F=t))},t.createNode=function(){var e=new Node2D;return e.setRenderDataByKey("size",[40,40]),e.setRadius(70),e.setRenderDataByKey("color","#FFFFFF"),e.setPosition(k(70)),r.push(e),e},t.linkNodes=function(e,t,n){if(null===e||void 0===e)throw"Failure to link! The first node passed in to link was: "+e;if(null===t||void 0===t)throw"Failure to link! The second node passed in to link was: "+t;e.addLink(t),t.addLink(e),a.push({nodes:[e,t],linkData:n})};var b=function(e,t,n,o){var i=t[0]-e[0],r=t[1]-e[1],a=Math.sqrt(i*i+r*r);if(0===a)return[0,0];var u=Math.abs(n*o),s=u/(a*a)*2.1;n+o>a&&(s*=-5);var d=Math.atan(r/i),c=1;return 0>i&&(c=-1),[Math.cos(d)*s*c,Math.sin(d)*s*c]},D=function(){c.canvas.width=c.canvas.offsetWidth,c.canvas.height=c.canvas.offsetHeight,c.clearRect(0,0,c.canvas.width,c.canvas.height),null!==u&&void 0!==u&&u(t),t.getContext().fillStyle="white",t.getContext().fillRect(t.getPosition()[0]*n,t.getPosition()[1]*n,10*n,10*n),r.forEach(function(e){e.getChildren().forEach(function(r){var a=t.getContext();a.beginPath(),a.moveTo((e.getPosition()[0]+o)*n,(e.getPosition()[1]+i)*n),a.lineTo((r.getPosition()[0]+o)*n,(r.getPosition()[1]+i)*n),a.stroke()})}),a.forEach(function(e){var r=[(e.nodes[0].getPosition()[0]+o)*n,(e.nodes[0].getPosition()[1]+i)*n],a=[(e.nodes[1].getPosition()[0]+o)*n,(e.nodes[1].getPosition()[1]+i)*n];if(null!==s&&void 0!==s)return void s(t,r,a,e);var u=t.getContext();u.beginPath(),u.moveTo(r[0],r[1]),u.lineTo(a[0],a[1]),u.stroke()}),r.forEach(function(e){var n=[0,0];r.forEach(function(t){var o=b(e.getPosition(),t.getPosition(),e.getRadius(),t.getRadius());n[0]+=o[0],n[1]+=o[1]});var o=b(e.getPosition(),[0,0],e.getRadius(),e.getRadius());n[0]+=10*o[0],n[1]+=10*o[1],e.accelerate(n[0],n[1]);var i=e.translate((Date.now()-E)/1e3);i&&null!==h&&(m(e,d(h))?e.setRenderDataByKey("$mouseOver",!0):e.setRenderDataByKey("$mouseOver",!1));var a=t.getPosition(),u=t.getScale(),s=[(e.getPosition()[0]+a[0])*u,(e.getPosition()[1]+a[1])*u];null!==e.getRenderFunction()&&void 0!==e.getRenderFunction()?e.render(e,s,t):C(e,s,t)}),E=Date.now(),window.requestAnimationFrame(D)},E=Date.now();D()}function Node2D(){var e=this,t="Node Name",n="Data",o={$mouseOver:!1,$beingDragged:!1},i=0,r=0,a=[],u=null,s=[],d=null,c=1,l=[0,0];e.getGroupId=function(){return d},e.accelerate=function(e,t){var n=300;l[0]=Math.max(Math.min(n,l[0]+e),-n),l[1]=Math.max(Math.min(n,l[1]+t),-n)};var f=function(e){var t=l[0]>0?-1:1,n=l[1]>0?-1:1;l[0]+=Math.sqrt(Math.abs(l[0]))*e*t*2,l[1]+=Math.sqrt(Math.abs(l[1]))*e*n*2};e.translate=function(e){return 0===l[0]&&0===l[1]?!1:(i+=l[0]*e,r+=l[1]*e,f(e),!0)},e.distanceFrom=function(e,t){return e.constructor===Array&&(t=e[1],e=e[0]),Math.sqrt(Math.pow(e-i,2)+Math.pow(t-r,2))},e.setRadius=function(e){c=e},e.getRadius=function(){return c},e.onclick=function(){console.log("Clicked")};var g=null,h=null;e.setRenderDataByKey=function(e,t){o[e]=t},e.getRenderData=function(){return o},e.wasClicked=function(t,n){if(null!==h&&void 0!==h){var o=h(e,t,n);if(o===!0||o===!1)return o}return!1},e.setRenderFunction=function(e,t){if(null===e)throw"Error setting render funciton for Node! Attempting to add a null render method";if(null===t)throw"Error setting render funciton for Node! Attempting to add a null click detection method";g=e,h=t},e.getRenderFunction=function(){return g},e.getClickDetectionFunction=function(){return h},e.render=function(e,t,n){if(null===g)throw"Failure to render node! There's no render function defined!";g(e,t,n)},e.getPosition=function(){return[i,r]},e.setPosition=function(e,t){return e.constructor===Array?(i=e[0],void(r=e[1])):(i=e,void(r=t))},e.getContents=function(){return t+" - "+n},e.addLink=function(e){if(null===e||void 0===e)throw"Failure to link node!  Link node was: "+e;s.push(e)},e.getLinks=function(){return s},e.setParent=function(t){null!==u&&void 0!==u&&u.removeChild(e),u=t,-1===u.getChildren().indexOf(e)&&u.addChild(e)},e.getParent=function(){return u},e.addChild=function(t){return-1!==a.indexOf(t)?void console.log("We already have that node as a child; ",t):(a.push(t),void(t.getParent()!==e&&t.setParent(e)))},e.getChildren=function(){return a},e.removeChild=function(e){var t=a.indexOf(e);if(-1===t)throw"Failure to remove child! Trying to remove a child we don't have!";a.splice(t,1)}}function pointsInsideRect(e,t){if(null===e||void 0===e||null===e.length||void 0===e.length||4!==e.length)throw"Invalid rect argument! Expecting array in format [x, y, width, height].  Instead recieved: "+e;if(null===t||void 0===t||null===t.length||void 0===t.length||2!==t.length)throw"Invalid point argument! Expecting array in format [x, y].  Instead recieved: "+t;return e[0]<=t[0]&&t[0]<=e[0]+e[2]&&e[1]<=t[1]&&t[1]<=e[1]+e[3]}function isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}!function(){function e(e){var t=this.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),i=o.length>>>0;if(0===i)return-1;if(n=+t||0,1/0===Math.abs(n)&&(n=0),n>=i)return-1;for(n=Math.max(n>=0?n:i-Math.abs(n),0);i>n;){if(n in o&&o[n]===e)return n;n++}return-1}),HTMLCanvasElement.prototype.relMouseCoords=e}();