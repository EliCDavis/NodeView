"use strict";function Graph2D(n){var t=this,e=1,i=0,o=0,r=[],a=function(n){var r=t.getContext().canvas.relMouseCoords(n),a=r.x/e-i,u=r.y/e-o;return{x:a,y:u}},u=null;t.getContext=function(){return u};var d=function(){return[t.getContext().canvas.width,t.getContext().canvas.height]},s="free",l=null,c=function(n){if("dragging"===s)return l=null,void(s="free");var e=a(n);r.forEach(function(n){n.wasClicked(t,[e.x,e.y])&&null!==n.onclick&&void 0!==n.onclick&&n.onclick()}),s="free"},f=function(n){var e=a(n);s="hold",r.forEach(function(n){n.wasClicked(t,[e.x,e.y])&&(l={item:n,itemPos:n.getPosition(),mousePos:[e.x,e.y],itemType:"node"},console.log("Clicked"))}),null===l&&(l={item:t,itemPos:t.getPosition(),mousePos:[e.x,e.y],itemType:"graph"})},g=function(n){"dragging"===s&&(s="free")},h=function(n){if("hold"===s&&(s="dragging"),"dragging"===s){var i=l.itemPos,o=l.mousePos;if("node"===l.itemType){var r=a(n);l.item.setPosition(r.x+(i[0]-o[0]),r.y+(i[1]-o[1]))}if("graph"===l.itemType){var r=t.getContext().canvas.relMouseCoords(n),u=r.x/e,d=r.y/e;l.item.setPosition(u-o[0],d-o[1])}}},v=function(n){n.deltaY>0?e-=.05:e+=.05},m=function(n){},P=function(n){n.addEventListener("mouseup",function(n){c(n)}),n.addEventListener("mousedown",function(n){f(n)}),n.addEventListener("mouseout",function(n){g(n)}),n.addEventListener("mousemove",function(n){h(n)}),n.addEventListener("mousewheel",function(n){v(n)}),n.addEventListener("dblclick",function(n){m(n)})};null!==n&&void 0!==n&&(u=n.getContext("2d"),P(n)),t.getPosition=function(){return[i,o]},t.setPosition=function(n,t){if(!isNumeric(n))throw"Failed to set graph position!  Invalid x value: "+n;if(!isNumeric(t))throw"Failed to set graph position!  Invalid y value: "+t;i=n,o=t},t.getScale=function(){return e};var p=function(n,t){var e=t.getPosition(),i=t.getScale(),o=n.getRenderData().size,r=[(n.getPosition()[0]-o[0]/2+e[0])*i,(n.getPosition()[1]-o[1]/2+e[1])*i];t.getContext().fillStyle=n.getRenderData().color,t.getContext().fillRect(r[0],r[1],o[0]*i,o[1]*i)},y=function(n,t,e){var i=n.getRenderData().size,o=[n.getPosition()[0]-i[0]/2,n.getPosition()[1]-i[1]/2],r=[i[0],i[1]];return pointsInsideRect([o[0],o[1],r[0],r[1]],e)};t.createNode=function(){var n=new Node2D;n.setRenderDataByKey("size",[40,40]),n.setRenderDataByKey("color","#6991AC"),n.setRenderFunction(p,y);var t=d(),e=[t[0]/2,t[1]/2];return n.setPosition(e[0],e[1]),r.push(n),n},t.linkNodes=function(n,t){if(null===n||void 0===n)throw"Failure to link! The first node passed in to link was: "+n;if(null===t||void 0===t)throw"Failure to link! The second node passed in to link was: "+t;n.addLink(t),t.addLink(n)};var x=function(){u.canvas.width=u.canvas.offsetWidth,u.canvas.height=u.canvas.offsetHeight,u.clearRect(0,0,u.canvas.width,u.canvas.height),t.getContext().fillRect(t.getPosition()[0]*e,t.getPosition()[1]*e,10*e,10*e),r.forEach(function(n){n.getChildren().forEach(function(r){var a=t.getContext();a.beginPath(),a.moveTo((n.getPosition()[0]+i)*e,(n.getPosition()[1]+o)*e),a.lineTo((r.getPosition()[0]+i)*e,(r.getPosition()[1]+o)*e),a.stroke()})}),r.forEach(function(n){n.getLinks().forEach(function(r){var a=t.getContext();a.beginPath(),a.moveTo((n.getPosition()[0]+i)*e,(n.getPosition()[1]+o)*e),a.lineTo((r.getPosition()[0]+i)*e,(r.getPosition()[1]+o)*e),a.stroke()})}),r.forEach(function(n){null!==n.getRenderFunction()&&void 0!==n.getRenderFunction()&&n.render(n,t)}),window.requestAnimationFrame(x)};x()}function Node2D(){var n=this,t="Node Name",e="Data",i={},o=0,r=0,a=[],u=null,d=[],s=1;n.setRadius=function(n){s=n},n.getRadius=function(){return s},n.onclick=function(){console.log("Clicked")};var l=null,c=null;n.setRenderDataByKey=function(n,t){i[n]=t},n.getRenderData=function(){return i},n.wasClicked=function(t,e){if(null!==c&&void 0!==c){var i=c(n,t,e);if(i===!0||i===!1)return i}return!1},n.setRenderFunction=function(n,t){if(null===n)throw"Error setting render funciton for Node! Attempting to add a null render method";if(null===t)throw"Error setting render funciton for Node! Attempting to add a null click detection method";l=n,c=t},n.getRenderFunction=function(){return l},n.render=function(n,t){if(null===l)throw"Failure to render node! There's no render function defined!";l(n,t)},n.getPosition=function(){return[o,r]},n.setPosition=function(n,t){o=n,r=t},n.getContents=function(){return t+" - "+e},n.addLink=function(n){if(null===n||void 0===n)throw"Failure to link node!  Link node was: "+n;d.push(n)},n.getLinks=function(){return d},n.setParent=function(t){null!==u&&void 0!==u&&u.removeChild(n),u=t,-1===u.getChildren().indexOf(n)&&u.addChild(n)},n.getParent=function(){return u},n.addChild=function(t){return-1!==a.indexOf(t)?void console.log("We already have that node as a child; ",t):(a.push(t),void(t.getParent()!==n&&t.setParent(n)))},n.getChildren=function(){return a},n.removeChild=function(n){var t=a.indexOf(n);if(-1===t)throw"Failure to remove child! Trying to remove a child we don't have!";a.splice(t,1)}}function pointsInsideRect(n,t){if(null===n||void 0===n||null===n.length||void 0===n.length||4!==n.length)throw"Invalid rect argument! Expecting array in format [x, y, width, height].  Instead recieved: "+n;if(null===t||void 0===t||null===t.length||void 0===t.length||2!==t.length)throw"Invalid point argument! Expecting array in format [x, y].  Instead recieved: "+t;return n[0]<=t[0]&&t[0]<=n[0]+n[2]&&n[1]<=t[1]&&t[1]<=n[1]+n[3]}function isNumeric(n){return!isNaN(parseFloat(n))&&isFinite(n)}!function(){function n(n){var t=this.getBoundingClientRect();return{x:n.clientX-t.left,y:n.clientY-t.top}}Array.prototype.indexOf||(Array.prototype.indexOf=function(n,t){var e;if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),o=i.length>>>0;if(0===o)return-1;if(e=+t||0,1/0===Math.abs(e)&&(e=0),e>=o)return-1;for(e=Math.max(e>=0?e:o-Math.abs(e),0);o>e;){if(e in i&&i[e]===n)return e;e++}return-1}),HTMLCanvasElement.prototype.relMouseCoords=n}();