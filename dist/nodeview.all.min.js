"use strict";function Graph2D(n){var t=this,e=1,i=0,o=0,r=[],a=function(r){var a=t.getContext().canvas.relMouseCoords(r),u=(a.x+i)/n.width*(1/e)*n.width,d=(a.y+o)/n.height*(1/e)*n.height;return{x:u,y:d}},u=null;t.getContext=function(){return u};var d=function(){return[t.getContext().canvas.width,t.getContext().canvas.height]},c="free",l=null,s=function(n){if("dragging"===c)return l=null,void(c="free");var e=a(n);r.forEach(function(n){n.wasClicked(t,[e.x,e.y])&&null!==n.onclick&&void 0!==n.onclick&&n.onclick()}),c="free"},f=function(n){var e=a(n);r.forEach(function(n){n.wasClicked(t,[e.x,e.y])&&(c="hold",l={item:n,itemPos:n.getPosition(),mousePos:[e.x,e.y]})})},g=function(n){"dragging"===c&&(c="free")},h=function(n){var t=a(n);if("hold"===c&&(c="dragging"),"dragging"===c){var e=l.itemPos,i=l.mousePos;l.item.setPosition(t.x+(e[0]-i[0]),t.y+(e[1]-i[1]))}},v=function(n){n.deltaY>0?e-=.05:e+=.05},m=function(n){},w=function(n){n.addEventListener("mouseup",function(n){s(n)}),n.addEventListener("mousedown",function(n){f(n)}),n.addEventListener("mouseout",function(n){g(n)}),n.addEventListener("mousemove",function(n){h(n)}),n.addEventListener("mousewheel",function(n){v(n)}),n.addEventListener("dblclick",function(n){m(n)})};null!==n&&void 0!==n&&(u=n.getContext("2d"),w(n)),t.getPosition=function(){return[i,o]},t.getScale=function(){return e};var y=function(n,t){var e=t.getPosition(),i=t.getScale(),o=n.getRenderData().size,r=[(n.getPosition()[0]-o[0]/2+e[0])*i,(n.getPosition()[1]-o[1]/2+e[1])*i];t.getContext().fillStyle=n.getRenderData().color,t.getContext().fillRect(r[0],r[1],o[0]*i,o[1]*i)},x=function(n,t,e){var i=t.getPosition(),o=(t.getScale(),n.getRenderData().size),r=[n.getPosition()[0]-o[0]/2+i[0],n.getPosition()[1]-o[1]/2+i[1]],a=[o[0],o[1]];return pointsInsideRect([r[0],r[1],a[0],a[1]],e)};t.createNode=function(){var n=new Node2D;n.setRenderDataByKey("size",[40,40]),n.setRenderDataByKey("color","#6991AC"),n.setRenderFunction(y,x);var t=d(),e=[t[0]/2,t[1]/2];return n.setPosition(e[0],e[1]),r.push(n),n},t.linkNodes=function(n,t){if(null===n||void 0===n)throw"Failure to link! The first node passed in to link was: "+n;if(null===t||void 0===t)throw"Failure to link! The second node passed in to link was: "+t;n.addLink(t),t.addLink(n)};var P=function(){u.canvas.width=u.canvas.offsetWidth,u.canvas.height=u.canvas.offsetHeight,u.clearRect(0,0,u.canvas.width,u.canvas.height),r.forEach(function(n){n.getLinks().forEach(function(r){var a=t.getContext();a.beginPath(),a.moveTo((n.getPosition()[0]+i)*e,(n.getPosition()[1]+o)*e),a.lineTo((r.getPosition()[0]+i)*e,(r.getPosition()[1]+o)*e),a.stroke()})}),r.forEach(function(n){null!==n.getRenderFunction()&&void 0!==n.getRenderFunction()&&n.render(n,t)}),window.requestAnimationFrame(P)};P()}function Node2D(){var n=this,t="Node Name",e="Data",i={},o=0,r=0,a=[],u=null,d=[],c=1;n.setRadius=function(n){c=n},n.getRadius=function(){return c},n.onclick=function(){console.log("Clicked")};var l=null,s=null;n.setRenderDataByKey=function(n,t){i[n]=t},n.getRenderData=function(){return i},n.wasClicked=function(t,e){if(null!==s&&void 0!==s){var i=s(n,t,e);if(i===!0||i===!1)return i}return!1},n.setRenderFunction=function(n,t){if(null===n)throw"Error setting render funciton for Node! Attempting to add a null render method";if(null===t)throw"Error setting render funciton for Node! Attempting to add a null click detection method";l=n,s=t},n.getRenderFunction=function(){return l},n.render=function(n,t){if(null===l)throw"Failure to render node! There's no render function defined!";l(n,t)},n.getPosition=function(){return[o,r]},n.setPosition=function(n,t){o=n,r=t},n.getContents=function(){return t+" - "+e},n.addLink=function(n){if(null===n||void 0===n)throw"Failure to link node!  Link node was: "+n;d.push(n)},n.getLinks=function(){return d},n.setParent=function(t){null!==u&&void 0!==u&&u.removeChild(n),u=t,-1===u.getChildren().indexOf(n)&&u.addChild(n)},n.getParent=function(){return u},n.addChild=function(t){return-1!==a.indexOf(t)?void console.log("We already have that node as a child; ",t):(a.push(t),void(t.getParent()!==n&&t.setParent(n)))},n.getChildren=function(){return a},n.removeChild=function(n){var t=a.indexOf(n);if(-1===t)throw"Failure to remove child! Trying to remove a child we don't have!";a.splice(t,1)}}function pointsInsideRect(n,t){if(null===n||void 0===n||null===n.length||void 0===n.length||4!==n.length)throw"Invalid rect argument! Expecting array in format [x, y, width, height].  Instead recieved: "+n;if(null===t||void 0===t||null===t.length||void 0===t.length||2!==t.length)throw"Invalid point argument! Expecting array in format [x, y].  Instead recieved: "+t;return n[0]<=t[0]&&t[0]<=n[0]+n[2]&&n[1]<=t[1]&&t[1]<=n[1]+n[3]}!function(){function n(n){var t=this.getBoundingClientRect();return{x:n.clientX-t.left,y:n.clientY-t.top}}Array.prototype.indexOf||(Array.prototype.indexOf=function(n,t){var e;if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),o=i.length>>>0;if(0===o)return-1;if(e=+t||0,1/0===Math.abs(e)&&(e=0),e>=o)return-1;for(e=Math.max(e>=0?e:o-Math.abs(e),0);o>e;){if(e in i&&i[e]===n)return e;e++}return-1}),HTMLCanvasElement.prototype.relMouseCoords=n}();