"use strict";function Graph2D(t){var n=this,e=1,o=0,i=0,r=[],a=[],u=function(t){var r=n.getContext().canvas.relMouseCoords(t),a=r.x/e-o,u=r.y/e-i;return{x:a,y:u}},s=null;n.getContext=function(){return s};var c=function(){return[n.getContext().canvas.width,n.getContext().canvas.height]},d="free",l=null,f=function(t){if("dragging"===d)return l=null,void(d="free");var e=u(t);r.forEach(function(t){t.wasClicked(n,[e.x,e.y])&&null!==t.onclick&&void 0!==t.onclick&&t.onclick()}),d="free"},g=function(t){var e=u(t);d="hold",r.forEach(function(t){t.wasClicked(n,[e.x,e.y])&&(l={item:t,itemPos:t.getPosition(),mousePos:[e.x,e.y],itemType:"node"},console.log("Clicked"))}),null===l&&(l={item:n,itemPos:n.getPosition(),mousePos:[e.x,e.y],itemType:"graph"})},h=function(t){"dragging"===d&&(d="free")},v=function(t){if("hold"===d&&(d="dragging"),"dragging"===d){var o=l.itemPos,i=l.mousePos;if("node"===l.itemType){var r=u(t);l.item.setPosition(r.x+(o[0]-i[0]),r.y+(o[1]-i[1]))}if("graph"===l.itemType){var r=n.getContext().canvas.relMouseCoords(t),a=r.x/e,s=r.y/e;l.item.setPosition(a-i[0],s-i[1])}}},m=function(t){var o=e,i=0;i=t.deltaY>0?-.05:.05,o+=i*o;var r=c(),a=[r[0]*(1/e)*.5,r[1]*(1/e)*.5],u=[r[0]*(1/o)*.5,r[1]*(1/o)*.5],s=n.getPosition();n.setPosition(s[0]+(u[0]-a[0]),s[1]+(u[1]-a[1])),e=o},P=function(t){},p=function(t){t.addEventListener("mouseup",function(t){f(t)}),t.addEventListener("mousedown",function(t){g(t)}),t.addEventListener("mouseout",function(t){h(t)}),t.addEventListener("mousemove",function(t){v(t)}),t.addEventListener("mousewheel",function(t){m(t)}),t.addEventListener("dblclick",function(t){P(t)})};null!==t&&void 0!==t&&(s=t.getContext("2d"),p(t)),n.getPosition=function(){return[o,i]},n.setPosition=function(t,n){if(!isNumeric(t))throw"Failed to set graph position!  Invalid x value: "+t;if(!isNumeric(n))throw"Failed to set graph position!  Invalid y value: "+n;o=t,i=n},n.getScale=function(){return e};var w=function(t,n){for(var e=0;e<r.length;e++){var o=r[e].getPosition(),i=Math.sqrt(Math.pow(o[0]-t[0],2)+Math.pow(o[1]-t[1],2));if(n>i)return!1}return!0},y=function(t){if(0===r.length){var n=c(),o=[n[0]/2,n[1]/2];return[o[0]*(1/e),o[1]*(1/e)]}var i=[0,0],a=[0,0];r.forEach(function(t){a[0]+=t.getPosition()[0],a[1]+=t.getPosition()[1]}),i[0]=a[0]/r.length,i[1]=a[1]/r.length;for(var u=t/4,s=(Math.sqrt(u*u*2),0);1e4>s;){var d=2*s;0===s&&(d=1);for(var l=[],f=[],g=[],h=[],v=(s+.5)*u,m=[i[0]-v,i[1]-v],P=[i[0]+v,i[1]-v],p=[i[0]-v,i[1]+v],y=[i[0]+v,i[1]+v],x=0;d>x;x++)l.push([m[0],m[1]+u*x]),f.push([y[0],y[1]-u*x]),g.push([P[0]-u*x,P[1]]),h.push([p[0]+u*x,p[1]]);for(var C=l.concat(f).concat(g).concat(h),x=0;x<C.length;x++)if(w(C[x],t))return C[x];s++}return console.log("Failure to find place! Sorry dude."),[0,0]},x=function(t,n){var e=n.getPosition(),o=n.getScale(),i=t.getRenderData().size,r=[(t.getPosition()[0]-i[0]/2+e[0])*o,(t.getPosition()[1]-i[1]/2+e[1])*o];n.getContext().fillStyle=t.getRenderData().color,n.getContext().fillRect(r[0],r[1],i[0]*o,i[1]*o)},C=function(t,n,e){var o=t.getRenderData().size,i=[t.getPosition()[0]-o[0]/2,t.getPosition()[1]-o[1]/2],r=[o[0],o[1]];return pointsInsideRect([i[0],i[1],r[0],r[1]],e)};n.createNode=function(){var t=new Node2D;return t.setRenderDataByKey("size",[40,40]),t.setRadius(70),t.setRenderDataByKey("color","#6991AC"),t.setRenderFunction(x,C),t.setPosition(y(70)),r.push(t),t},n.linkNodes=function(t,n,e){if(null===t||void 0===t)throw"Failure to link! The first node passed in to link was: "+t;if(null===n||void 0===n)throw"Failure to link! The second node passed in to link was: "+n;t.addLink(n),n.addLink(t),a.push({nodes:[t,n],linkData:e})};var k=function(){s.canvas.width=s.canvas.offsetWidth,s.canvas.height=s.canvas.offsetHeight,s.clearRect(0,0,s.canvas.width,s.canvas.height),n.getContext().fillRect(n.getPosition()[0]*e,n.getPosition()[1]*e,10*e,10*e),r.forEach(function(t){t.getChildren().forEach(function(r){var a=n.getContext();a.beginPath(),a.moveTo((t.getPosition()[0]+o)*e,(t.getPosition()[1]+i)*e),a.lineTo((r.getPosition()[0]+o)*e,(r.getPosition()[1]+i)*e),a.stroke()})}),a.forEach(function(t){var r=n.getContext();r.beginPath(),r.moveTo((t.nodes[0].getPosition()[0]+o)*e,(t.nodes[0].getPosition()[1]+i)*e),r.lineTo((t.nodes[1].getPosition()[0]+o)*e,(t.nodes[1].getPosition()[1]+i)*e),r.stroke()}),r.forEach(function(t){var e=[0,0];r.forEach(function(n){var o=t.distanceFrom(n.getPosition());if(0!==o){o*=o;var i=t.getRadius()*n.getRadius(),r=o/i*.1,a=n.getPosition()[0]-t.getPosition()[0],u=n.getPosition()[0]-t.getPosition()[1],s=Math.atan(u/a),c=1;0>a&&(c=-1),e[0]+=Math.cos(s)*r*c,e[1]+=Math.sin(s)*r*c}}),t.accelerate(e[0],e[1]),t.translate((Date.now()-R)/1e3),null!==t.getRenderFunction()&&void 0!==t.getRenderFunction()&&t.render(t,n)}),R=Date.now(),window.requestAnimationFrame(k)},R=Date.now();k()}function Node2D(){var t=this,n="Node Name",e="Data",o={},i=0,r=0,a=[],u=null,s=[],c=1,d=[0,0];t.accelerate=function(t,n){var e=100;d[0]=Math.max(Math.min(e,d[0]+t),-e),d[1]=Math.max(Math.min(e,d[1]+n),-e)},t.translate=function(t){i+=d[0]*t,r+=d[1]*t},t.distanceFrom=function(t,n){return t.constructor===Array&&(n=t[1],t=t[0]),Math.sqrt(Math.pow(t-i,2)+Math.pow(n-r,2))},t.setRadius=function(t){c=t},t.getRadius=function(){return c},t.onclick=function(){console.log("Clicked")};var l=null,f=null;t.setRenderDataByKey=function(t,n){o[t]=n},t.getRenderData=function(){return o},t.wasClicked=function(n,e){if(null!==f&&void 0!==f){var o=f(t,n,e);if(o===!0||o===!1)return o}return!1},t.setRenderFunction=function(t,n){if(null===t)throw"Error setting render funciton for Node! Attempting to add a null render method";if(null===n)throw"Error setting render funciton for Node! Attempting to add a null click detection method";l=t,f=n},t.getRenderFunction=function(){return l},t.render=function(t,n){if(null===l)throw"Failure to render node! There's no render function defined!";l(t,n)},t.getPosition=function(){return[i,r]},t.setPosition=function(t,n){return t.constructor===Array?(i=t[0],void(r=t[1])):(i=t,void(r=n))},t.getContents=function(){return n+" - "+e},t.addLink=function(t){if(null===t||void 0===t)throw"Failure to link node!  Link node was: "+t;s.push(t)},t.getLinks=function(){return s},t.setParent=function(n){null!==u&&void 0!==u&&u.removeChild(t),u=n,-1===u.getChildren().indexOf(t)&&u.addChild(t)},t.getParent=function(){return u},t.addChild=function(n){return-1!==a.indexOf(n)?void console.log("We already have that node as a child; ",n):(a.push(n),void(n.getParent()!==t&&n.setParent(t)))},t.getChildren=function(){return a},t.removeChild=function(t){var n=a.indexOf(t);if(-1===n)throw"Failure to remove child! Trying to remove a child we don't have!";a.splice(n,1)}}function pointsInsideRect(t,n){if(null===t||void 0===t||null===t.length||void 0===t.length||4!==t.length)throw"Invalid rect argument! Expecting array in format [x, y, width, height].  Instead recieved: "+t;if(null===n||void 0===n||null===n.length||void 0===n.length||2!==n.length)throw"Invalid point argument! Expecting array in format [x, y].  Instead recieved: "+n;return t[0]<=n[0]&&n[0]<=t[0]+t[2]&&t[1]<=n[1]&&n[1]<=t[1]+t[3]}function isNumeric(t){return!isNaN(parseFloat(t))&&isFinite(t)}!function(){function t(t){var n=this.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}Array.prototype.indexOf||(Array.prototype.indexOf=function(t,n){var e;if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),i=o.length>>>0;if(0===i)return-1;if(e=+n||0,1/0===Math.abs(e)&&(e=0),e>=i)return-1;for(e=Math.max(e>=0?e:i-Math.abs(e),0);i>e;){if(e in o&&o[e]===t)return e;e++}return-1}),HTMLCanvasElement.prototype.relMouseCoords=t}();