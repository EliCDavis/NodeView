"use strict";function Graph2D(n){var e=this,t=1,i=0,o=0,r=[],a=[],u=function(n){var r=e.getContext().canvas.relMouseCoords(n),a=r.x/t-i,u=r.y/t-o;return{x:a,y:u}},d=null;e.getContext=function(){return d};var s=function(){return[e.getContext().canvas.width,e.getContext().canvas.height]},l="free",c=null,f=function(n){if("dragging"===l)return c=null,void(l="free");var t=u(n);r.forEach(function(n){n.wasClicked(e,[t.x,t.y])&&null!==n.onclick&&void 0!==n.onclick&&n.onclick()}),l="free"},g=function(n){var t=u(n);l="hold",r.forEach(function(n){n.wasClicked(e,[t.x,t.y])&&(c={item:n,itemPos:n.getPosition(),mousePos:[t.x,t.y],itemType:"node"},console.log("Clicked"))}),null===c&&(c={item:e,itemPos:e.getPosition(),mousePos:[t.x,t.y],itemType:"graph"})},h=function(n){"dragging"===l&&(l="free")},v=function(n){if("hold"===l&&(l="dragging"),"dragging"===l){var i=c.itemPos,o=c.mousePos;if("node"===c.itemType){var r=u(n);c.item.setPosition(r.x+(i[0]-o[0]),r.y+(i[1]-o[1]))}if("graph"===c.itemType){var r=e.getContext().canvas.relMouseCoords(n),a=r.x/t,d=r.y/t;c.item.setPosition(a-o[0],d-o[1])}}},m=function(n){var i=t,o=0;o=n.deltaY>0?-.05:.05,i+=o*i;var r=s(),a=[r[0]*(1/t)*.5,r[1]*(1/t)*.5],u=[r[0]*(1/i)*.5,r[1]*(1/i)*.5],d=e.getPosition();e.setPosition(d[0]+(u[0]-a[0]),d[1]+(u[1]-a[1])),t=i},P=function(n){},p=function(n){n.addEventListener("mouseup",function(n){f(n)}),n.addEventListener("mousedown",function(n){g(n)}),n.addEventListener("mouseout",function(n){h(n)}),n.addEventListener("mousemove",function(n){v(n)}),n.addEventListener("mousewheel",function(n){m(n)}),n.addEventListener("dblclick",function(n){P(n)})};null!==n&&void 0!==n&&(d=n.getContext("2d"),p(n)),e.getPosition=function(){return[i,o]},e.setPosition=function(n,e){if(!isNumeric(n))throw"Failed to set graph position!  Invalid x value: "+n;if(!isNumeric(e))throw"Failed to set graph position!  Invalid y value: "+e;i=n,o=e},e.getScale=function(){return t};var y=function(n,e){var t=e.getPosition(),i=e.getScale(),o=n.getRenderData().size,r=[(n.getPosition()[0]-o[0]/2+t[0])*i,(n.getPosition()[1]-o[1]/2+t[1])*i];e.getContext().fillStyle=n.getRenderData().color,e.getContext().fillRect(r[0],r[1],o[0]*i,o[1]*i)},x=function(n,e,t){var i=n.getRenderData().size,o=[n.getPosition()[0]-i[0]/2,n.getPosition()[1]-i[1]/2],r=[i[0],i[1]];return pointsInsideRect([o[0],o[1],r[0],r[1]],t)};e.createNode=function(){var n=new Node2D;n.setRenderDataByKey("size",[40,40]),n.setRenderDataByKey("color","#6991AC"),n.setRenderFunction(y,x);var e=s(),i=[e[0]/2,e[1]/2];return n.setPosition(i[0]*(1/t),i[1]*(1/t)),r.push(n),n},e.linkNodes=function(n,e,t){if(null===n||void 0===n)throw"Failure to link! The first node passed in to link was: "+n;if(null===e||void 0===e)throw"Failure to link! The second node passed in to link was: "+e;n.addLink(e),e.addLink(n),a.push({nodes:[n,e],linkData:t})};var C=function(){d.canvas.width=d.canvas.offsetWidth,d.canvas.height=d.canvas.offsetHeight,d.clearRect(0,0,d.canvas.width,d.canvas.height),e.getContext().fillRect(e.getPosition()[0]*t,e.getPosition()[1]*t,10*t,10*t),r.forEach(function(n){n.getChildren().forEach(function(r){var a=e.getContext();a.beginPath(),a.moveTo((n.getPosition()[0]+i)*t,(n.getPosition()[1]+o)*t),a.lineTo((r.getPosition()[0]+i)*t,(r.getPosition()[1]+o)*t),a.stroke()})}),a.forEach(function(n){var r=e.getContext();r.beginPath(),r.moveTo((n.nodes[0].getPosition()[0]+i)*t,(n.nodes[0].getPosition()[1]+o)*t),r.lineTo((n.nodes[1].getPosition()[0]+i)*t,(n.nodes[1].getPosition()[1]+o)*t),r.stroke()}),r.forEach(function(n){null!==n.getRenderFunction()&&void 0!==n.getRenderFunction()&&n.render(n,e)}),window.requestAnimationFrame(C)};C()}function Node2D(){var n=this,e="Node Name",t="Data",i={},o=0,r=0,a=[],u=null,d=[],s=1;n.setRadius=function(n){s=n},n.getRadius=function(){return s},n.onclick=function(){console.log("Clicked")};var l=null,c=null;n.setRenderDataByKey=function(n,e){i[n]=e},n.getRenderData=function(){return i},n.wasClicked=function(e,t){if(null!==c&&void 0!==c){var i=c(n,e,t);if(i===!0||i===!1)return i}return!1},n.setRenderFunction=function(n,e){if(null===n)throw"Error setting render funciton for Node! Attempting to add a null render method";if(null===e)throw"Error setting render funciton for Node! Attempting to add a null click detection method";l=n,c=e},n.getRenderFunction=function(){return l},n.render=function(n,e){if(null===l)throw"Failure to render node! There's no render function defined!";l(n,e)},n.getPosition=function(){return[o,r]},n.setPosition=function(n,e){o=n,r=e},n.getContents=function(){return e+" - "+t},n.addLink=function(n){if(null===n||void 0===n)throw"Failure to link node!  Link node was: "+n;d.push(n)},n.getLinks=function(){return d},n.setParent=function(e){null!==u&&void 0!==u&&u.removeChild(n),u=e,-1===u.getChildren().indexOf(n)&&u.addChild(n)},n.getParent=function(){return u},n.addChild=function(e){return-1!==a.indexOf(e)?void console.log("We already have that node as a child; ",e):(a.push(e),void(e.getParent()!==n&&e.setParent(n)))},n.getChildren=function(){return a},n.removeChild=function(n){var e=a.indexOf(n);if(-1===e)throw"Failure to remove child! Trying to remove a child we don't have!";a.splice(e,1)}}function pointsInsideRect(n,e){if(null===n||void 0===n||null===n.length||void 0===n.length||4!==n.length)throw"Invalid rect argument! Expecting array in format [x, y, width, height].  Instead recieved: "+n;if(null===e||void 0===e||null===e.length||void 0===e.length||2!==e.length)throw"Invalid point argument! Expecting array in format [x, y].  Instead recieved: "+e;return n[0]<=e[0]&&e[0]<=n[0]+n[2]&&n[1]<=e[1]&&e[1]<=n[1]+n[3]}function isNumeric(n){return!isNaN(parseFloat(n))&&isFinite(n)}!function(){function n(n){var e=this.getBoundingClientRect();return{x:n.clientX-e.left,y:n.clientY-e.top}}Array.prototype.indexOf||(Array.prototype.indexOf=function(n,e){var t;if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),o=i.length>>>0;if(0===o)return-1;if(t=+e||0,1/0===Math.abs(t)&&(t=0),t>=o)return-1;for(t=Math.max(t>=0?t:o-Math.abs(t),0);o>t;){if(t in i&&i[t]===n)return t;t++}return-1}),HTMLCanvasElement.prototype.relMouseCoords=n}();