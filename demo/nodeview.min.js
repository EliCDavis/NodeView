"use strict";function Graph2D(n){var t=this,e=1,i=0,o=0,r=[],a=[],u=function(n){var r=t.getContext().canvas.relMouseCoords(n),a=r.x/e-i,u=r.y/e-o;return{x:a,y:u}},s=null;t.getContext=function(){return s};var d=function(){return[t.getContext().canvas.width,t.getContext().canvas.height]},c="free",l=null,f=function(n){if("dragging"===c)return l=null,void(c="free");var e=u(n);r.forEach(function(n){n.wasClicked(t,[e.x,e.y])&&null!==n.onclick&&void 0!==n.onclick&&n.onclick()}),c="free"},g=function(n){var e=u(n);c="hold",r.forEach(function(n){n.wasClicked(t,[e.x,e.y])&&(l={item:n,itemPos:n.getPosition(),mousePos:[e.x,e.y],itemType:"node"},console.log("Clicked"))}),null===l&&(l={item:t,itemPos:t.getPosition(),mousePos:[e.x,e.y],itemType:"graph"})},h=function(n){"dragging"===c&&(c="free")},v=function(n){if("hold"===c&&(c="dragging"),"dragging"===c){var i=l.itemPos,o=l.mousePos;if("node"===l.itemType){var r=u(n);l.item.setPosition(r.x+(i[0]-o[0]),r.y+(i[1]-o[1]))}if("graph"===l.itemType){var r=t.getContext().canvas.relMouseCoords(n),a=r.x/e,s=r.y/e;l.item.setPosition(a-o[0],s-o[1])}}},m=function(n){var i=e,o=0;o=n.deltaY>0?-.05:.05,i+=o*i;var r=d(),a=[r[0]*(1/e)*.5,r[1]*(1/e)*.5],u=[r[0]*(1/i)*.5,r[1]*(1/i)*.5],s=t.getPosition();t.setPosition(s[0]+(u[0]-a[0]),s[1]+(u[1]-a[1])),e=i},p=function(n){},P=function(n){n.addEventListener("mouseup",function(n){f(n)}),n.addEventListener("mousedown",function(n){g(n)}),n.addEventListener("mouseout",function(n){h(n)}),n.addEventListener("mousemove",function(n){v(n)}),n.addEventListener("mousewheel",function(n){m(n)}),n.addEventListener("dblclick",function(n){p(n)})};null!==n&&void 0!==n&&(s=n.getContext("2d"),P(n)),t.getPosition=function(){return[i,o]},t.setPosition=function(n,t){if(!isNumeric(n))throw"Failed to set graph position!  Invalid x value: "+n;if(!isNumeric(t))throw"Failed to set graph position!  Invalid y value: "+t;i=n,o=t},t.getScale=function(){return e};var y=function(n,t){var e=!0;return r.forEach(function(i){var o=i.getPosition(),r=Math.sqrt(Math.pow(o[0]-n[0],2)+Math.pow(o[1]-n[1],2));t>r&&(e=!1)}),e},w=function(n){if(0===r.length){var t=d(),i=[t[0]/2,t[1]/2];return[i[0]*(1/e),i[1]*(1/e)]}var o=[0,0],a=[0,0];r.forEach(function(n){a[0]+=n.getPosition()[0],a[1]+=n.getPosition()[1]}),o[0]=a[0]/r.length,o[1]=a[1]/r.length;for(var u=n/4,s=Math.sqrt(u*u*2),c=0;1e4>c;){for(var l=c+1,f=[],g=[],h=[],v=[],m=s*c,p=[o[0]-m,o[1]-m],P=[o[0]+m,o[1]-m],w=[o[0]-m,o[1]+m],x=[o[0]+m,o[1]+m],C=0;l>C;C++)f.push([p[0],p[1]+u*C]),g.push([x[0],x[1]-u*C]),h.push([P[0]-u*C,P[1]]),v.push([w[0]+u*C,w[1]]);for(var k=f.concat(g).concat(h).concat(v),C=0;C<k.length;C++)if(y(k[C],n))return k[C];c++}return[0,0]},x=function(n,t){var e=t.getPosition(),i=t.getScale(),o=n.getRenderData().size,r=[(n.getPosition()[0]-o[0]/2+e[0])*i,(n.getPosition()[1]-o[1]/2+e[1])*i];t.getContext().fillStyle=n.getRenderData().color,t.getContext().fillRect(r[0],r[1],o[0]*i,o[1]*i)},C=function(n,t,e){var i=n.getRenderData().size,o=[n.getPosition()[0]-i[0]/2,n.getPosition()[1]-i[1]/2],r=[i[0],i[1]];return pointsInsideRect([o[0],o[1],r[0],r[1]],e)};t.createNode=function(){var n=new Node2D;return n.setRenderDataByKey("size",[40,40]),n.setRadius(70),n.setRenderDataByKey("color","#6991AC"),n.setRenderFunction(x,C),n.setPosition(w(70)),r.push(n),n},t.linkNodes=function(n,t,e){if(null===n||void 0===n)throw"Failure to link! The first node passed in to link was: "+n;if(null===t||void 0===t)throw"Failure to link! The second node passed in to link was: "+t;n.addLink(t),t.addLink(n),a.push({nodes:[n,t],linkData:e})};var k=function(){s.canvas.width=s.canvas.offsetWidth,s.canvas.height=s.canvas.offsetHeight,s.clearRect(0,0,s.canvas.width,s.canvas.height),t.getContext().fillRect(t.getPosition()[0]*e,t.getPosition()[1]*e,10*e,10*e),r.forEach(function(n){n.getChildren().forEach(function(r){var a=t.getContext();a.beginPath(),a.moveTo((n.getPosition()[0]+i)*e,(n.getPosition()[1]+o)*e),a.lineTo((r.getPosition()[0]+i)*e,(r.getPosition()[1]+o)*e),a.stroke()})}),a.forEach(function(n){var r=t.getContext();r.beginPath(),r.moveTo((n.nodes[0].getPosition()[0]+i)*e,(n.nodes[0].getPosition()[1]+o)*e),r.lineTo((n.nodes[1].getPosition()[0]+i)*e,(n.nodes[1].getPosition()[1]+o)*e),r.stroke()}),r.forEach(function(n){null!==n.getRenderFunction()&&void 0!==n.getRenderFunction()&&n.render(n,t)}),window.requestAnimationFrame(k)};k()}function Node2D(){var n=this,t="Node Name",e="Data",i={},o=0,r=0,a=[],u=null,s=[],d=1;n.setRadius=function(n){d=n},n.getRadius=function(){return d},n.onclick=function(){console.log("Clicked")};var c=null,l=null;n.setRenderDataByKey=function(n,t){i[n]=t},n.getRenderData=function(){return i},n.wasClicked=function(t,e){if(null!==l&&void 0!==l){var i=l(n,t,e);if(i===!0||i===!1)return i}return!1},n.setRenderFunction=function(n,t){if(null===n)throw"Error setting render funciton for Node! Attempting to add a null render method";if(null===t)throw"Error setting render funciton for Node! Attempting to add a null click detection method";c=n,l=t},n.getRenderFunction=function(){return c},n.render=function(n,t){if(null===c)throw"Failure to render node! There's no render function defined!";c(n,t)},n.getPosition=function(){return[o,r]},n.setPosition=function(n,t){return n.constructor===Array?(o=n[0],void(r=n[1])):(o=n,void(r=t))},n.getContents=function(){return t+" - "+e},n.addLink=function(n){if(null===n||void 0===n)throw"Failure to link node!  Link node was: "+n;s.push(n)},n.getLinks=function(){return s},n.setParent=function(t){null!==u&&void 0!==u&&u.removeChild(n),u=t,-1===u.getChildren().indexOf(n)&&u.addChild(n)},n.getParent=function(){return u},n.addChild=function(t){return-1!==a.indexOf(t)?void console.log("We already have that node as a child; ",t):(a.push(t),void(t.getParent()!==n&&t.setParent(n)))},n.getChildren=function(){return a},n.removeChild=function(n){var t=a.indexOf(n);if(-1===t)throw"Failure to remove child! Trying to remove a child we don't have!";a.splice(t,1)}}function pointsInsideRect(n,t){if(null===n||void 0===n||null===n.length||void 0===n.length||4!==n.length)throw"Invalid rect argument! Expecting array in format [x, y, width, height].  Instead recieved: "+n;if(null===t||void 0===t||null===t.length||void 0===t.length||2!==t.length)throw"Invalid point argument! Expecting array in format [x, y].  Instead recieved: "+t;return n[0]<=t[0]&&t[0]<=n[0]+n[2]&&n[1]<=t[1]&&t[1]<=n[1]+n[3]}function isNumeric(n){return!isNaN(parseFloat(n))&&isFinite(n)}!function(){function n(n){var t=this.getBoundingClientRect();return{x:n.clientX-t.left,y:n.clientY-t.top}}Array.prototype.indexOf||(Array.prototype.indexOf=function(n,t){var e;if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),o=i.length>>>0;if(0===o)return-1;if(e=+t||0,1/0===Math.abs(e)&&(e=0),e>=o)return-1;for(e=Math.max(e>=0?e:o-Math.abs(e),0);o>e;){if(e in i&&i[e]===n)return e;e++}return-1}),HTMLCanvasElement.prototype.relMouseCoords=n}();